---
title: "Group Fused Lasso"
author: ""
date: "24 avril 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## First exemple 

We have $p = 20$ "locus" each of them have four segregation (of parents allele) types (AC, AD, BC, BD). We have have two conditions (I and NI).
We want to explain a phenotype trait $y$. 
The idea is to classified the  locus into three clusters :
  * **A** the ones that are not used to explain the locus 
  * **B** the ones that are used to explain the   in the same way for the two conditions (one way per types)
  * **C** the ones that explain the locus differently for the two conditions (one way per couple types*conditions)
  
To perform this classification we propose to study the  model $y = Xb + E$, where $X$ is a $20 * 4 * 2 + 20*4 = 240$ columns matrix .   
Let us call $V = X^{1(I)}_{AC}$ the $j^{th}$ elements of $V$ is equal to the value of the first locus if the $j^{th}$ sample belong to the type $AC$ and the condition $I$ and 0 otherwise.
More general let us call $X^{k(C)}_{T}$, the columns of $X$ such that the $j^{th}$ elements of this column is equal to the value of the $k^{th}$ locus if the $j^{th}$ sample belong to the type $T$ and the condition $C$ and 0 otherwise.  Let $b^{k(C)}_{T}$ be the value of $b$ associated to this columns.
This defined the first 160 columns of $X$. The last $20*4$ are  the vectors $X^{k(.)}_{T}$, such that the $j^{th}$ elements of this column is equal to the value of the $k^{th}$ locus if the $j^{th}$ sample belong to the type $T$ and the condition $C$ and 0 otherwise. Let $b^{k(.)}_{T}$ be the value of $b$ associated to this columns. Let us notice that $X^{k(.)}_{T} =X^{k(I)}_{T} +X^{k(NI)}_{T}$. To simplify the notation we will  introduce the vectors  $b^{k(.)} =(b^{k(.)}_{AC},b^{k(.)}_{AD},b^{k(.)}_{BC},b^{k(.)}_{BD})$, $b^{k(I)} =(b^{k(I)}_{AC},b^{k(I)}_{AD},b^{k(I)}_{BC},b^{k(I)}_{BD})$, $b^{k(NI)} =(b^{k(NI)}_{AC},b^{k(NI)}_{AD},b^{k(NI)}_{BC},b^{k(NI)}_{BD})$.


The three clusters described above can then be described as follows :
  * **A** the vectors $b^{k(.)}$ and $b^{k(C)}$ are null.
  * **B** the vector $b^{k(.)}$ is different from 0 and the vectors $b^{k(I)}$ and $b^{k(NI)}$  are null.
  * **C** :
      + the vector $b^{k(.)}$ is null and the vector $b^{k(C)}$ is different from 0 for $C$ equal to I or NI  (but not both).
      +  the vector $b^{k(.)}$ is null and the vectors $b^{k(I)}$ and $b^{k(NI)}$ are different from 0 but with different sign for at least one of the type.
      + the coefficients $b^{k(.)}$ are different from zero and the coefficients  and the coefficients $b^{k(C)}$ are different from 0 for $C$ equal to I or NI (but not both).


The three type of cluster select or fused the two conditions for the 4 differents types of a same locus $k$ simultaneously. Hence we propose to perform group Lasso, group on the loccus. Moreover to select the variables $X^{k(.)}_{AC},X^{k(.)}_{AD},X^{k(.)}_{BC},X^{k(.)}_{BD}$  instead of $X^{k(I)}_{AC},X^{k(I)}_{AD},X^{k(I)}_{BC},X^{k(I)}_{BD} $ and $X^{k(NI)}_{AC},X^{k(NI)}_{AD},X^{k(NI)}_{BC},X^{k(NI)}_{BD} $  for the locus $k$  when the two conditions have similar coefficients we will put differents penalties on  the coefficients $b^{k(C)}$ and on the coefficients $b^{k(.)}$. 


Hence  we propose to resolve the following problem : 

$ \widehat{b}_{\lambda,a,b}=\textrm{Argmin}_b\left\{\|y - Xb\|_2^2 + \lambda \sum_{i=1}^p(\alpha\|b^{k(.)}\|_2 + \beta\|b^{k(I)}\|_2 + \beta\|b^{k(NI)}\|_2 ) \right\}$ 

```{r}
p <- 20
t <- c("AC","AD","BC","BD")
C <- c("I","NI")

```

